<div class="row">
  <div class="col-sm-7">
    <div class="panel panel-default">
      <div class="panel-body">
        <h4>Lakes of Fire <%= t(:year) %> What Where When!</h4>
        <p>This guide is a volunteer project organized by the Info_bot team. Submit your events below to be included in the printed WhatWhereWhen guide that will be handed out at the gate at Lakes of Fire! They will also be included in any mobile or web-apps about Lakes of Fire events. We reserve the right to make changes for clarity.</p>
        <p>Please use the <a href="/events.xml">XML feed</a> of this event guide for good! Contact Info_bot at info-bot@lakesoffire.org with any questions or software bugs.</p>
        <p>Along with submitting an event, you can edit your event. Just remember to log in with the same account you used to create it. Events will no longer be editable once we send the guide to the printer.</p>
      </div>
    </div>
  </div>

  <div class="col-sm-5">
    <div class="panel panel-default">
      <div class="panel-body">
        <h4><%= t(:event_name).upcase %> Event Requirements</h4>
        <p>Like <%= link_to "Lakes of Fire", "http://lakesoffire.org/the-event/", target: "blank" %> itself, events in the What Where When guide must</p>
        <ul>
          <li>Start after Lakes of Fire starts at <%= event_requirements_start_time %></li>
          <li>End before Lakes of Fire ends at <%= event_requirements_end_time %></li>
        </ul>
        <p>Please note, all fields are required, but your contact information will only be used if we have questions about your submitted event.</p>
      </div>
    </div>
  </div>
</div> <!-- /row -->

<%= render partial: "event_form_header" %>

<div class="row">

  <div class="col-md-6 col-sm-6">
    <div class="well">

      <% if t(:download_map_url).include?("http") %>
        <h3>
          The <%= "Lakes of Fire #{t(:year)} #{t(:event_name).upcase}" %> Map is ready!
          <%= link_to "Download", t(:download_map_url).html_safe, target: "_blank" %> a copy!
        </h3>
      <% end %>

      <% if @event %>
        <% if !submissions_are_open && current_user.admin%>
          <span class="text-success">
            event submissions are closed, but, <b>as an admin</b>, you are still able to add and edit events!
          </span
        <% end %>

        <%= form_for @event, class: "form-inline" do |f| %>
          <h4>Add an Event</h4>
          <p>Please use discretion in describing your event and do not reference specific sexual acts or illegal activities. Lakes of Fire is a part of the larger community in which we do our thing and we will not publish events in the WWW that could negatively impact our relationship with the larger community, and in turn our future events.</p>

          <%= render 'event_form', f: f %>

          <%= submit_tag "Add", :class=>"btn btn-success" %>
        <% end %>
      <% else %>
        Event submissions are closed!
      <% end %>
    </div>
  </div>

  <div class="col-md-6 col-sm-6">
    <div class="panel panel-default">
      <% current_day = nil %>
      <div class="panel-body">
        <a href="/events.xml" class="pull-right">XML</a>
        <h4><%= t(:year) %> Submitted Events</h4>

        <div class="row">
          <div class='col-md-12'>
            <a href="#hearted" class="btn btn-default btn-xs pull-right btn-hearted-events">&nbsp;&hearts;&nbsp;</a>
            <a href="#yours" class="btn btn-default btn-xs pull-right btn-your-events">Yours</a>
            <a href="#all" class="btn btn-default btn-xs pull-right btn-all-events">All</a>
          </div>
        </div>

        <% @events.each do |event| %>
          <% if current_day != event.current_event_time.starting.to_date %>
            <% current_day = event.current_event_time.starting.to_date %>
            <div class="row">
              <div class='col-md-12'>
                <h4><%= current_day.strftime("%A, %B #{current_day.day.ordinalize}") %></h4>
              </div>
            </div>
          <% end %>

          <%
            css_class = ""
            css_class += (event.user == current_user) ? " your-event " : " not-your-event "
            css_class += (current_user.heart_for?(event.current_event_time)) ? " hearted " : " not-hearted "
          %>
          <div class="row event <%= css_class %>">
            <div class='col-md-12 <%= "event-#{event.id}" %>'>
              <a href="#_" class="heart-click" event-time-id="<%= event.current_event_time.id %>">
                &hearts;
              </a>

              <%= link_to event do
                    "#{h event.title} - #{h event.hosting_location} - #{event.current_event_time.starting.strftime("%l:%M %p")}".html_safe +
                    event_icons(event).html_safe
                  end
              %>
              <% if event_is_editable?(event, current_user) %>
                <small><%= link_to "edit", edit_event_path(event), class: 'text-muted', style: "margin-left: 5px;" %></small>
              <% end %>
              <% if event.current_event_time.all_day %>
                <small class="text-info pull-right" style="margin-left: 5px;">all day!</small>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>

    </div>
  </div>

</div>
